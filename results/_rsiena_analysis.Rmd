---
title: "Scraping Twitter"
author: "Anuschka Peelen"
date: "`r Sys.Date()`"
output: html_document
---

```{r warning=FALSE, globalsettings, echo=FALSE, results='hide'}
library(knitr)

knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()



colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/data/data_net_array.RData")
load("Users/anuschka/Documents/labjournal/data/socdef_net_array.RData")
load("Users/anuschka/Documents/labjournal/data/socdef_df.RData")
load("Users/anuschka/Documents/labjournal/data/datadef_df.RData")
```

# Estimate a model for sociology

```{r, echo=FALSE}
#load dataobjects
load("/Users/anuschka/Documents/labjournal/data/socdef_net_array.RData")
load("/Users/anuschka/Documents/labjournal/data/socdef_df.RData")
#load("./data/soc_staff_cit.RData")
library(RSiena)
library(tidyverse)
```


```{r, eval=FALSE}
#dependent
snet <- sienaDependent(soc_net_array)

### Step 1: define data
#gender
gender <- as.numeric(socdef_df$gender=="female")
gender <- coCovar(gender)

#Kardashian Index
ki <- as.numeric(socdef_df$ki)
ki <- coCovar(ki)

#Ethnicity
dutch <- as.numeric(socdef_df$dutch)
dutch <- coCovar(dutch)

#Twitter dummy as control variable
twitter_dum <- (socdef_df$twitter_dum)
twitter_dum <- coCovar(twitter_dum)

#year first pub
# soc_staff_cit %>% group_by(gs_id) %>%
#   mutate(pub_first = min(year)) %>% 
#   select(c("gs_id", "pub_first")) %>%
#   distinct(gs_id, pub_first, .keep_all = TRUE) -> firstpub_df
# 
# socdef_df <- left_join(socdef_df, firstpub_df)
# 
# #if no publication yet, set pub_first op 2023
# socdef_df %>% mutate(pub_first = replace_na(pub_first, 2023)) -> socdef_df

pub_first <-  coCovar(socdef_df$pub_first)
```



```{r}
mydata <- sienaDataCreate(dnet, gender, ki, dutch, pub_first, twitter_dum)
```

```{r}
### Step 2: create effects structure
myeff <- getEffects(mydata)
effectsDocumentation(myeff)
### Step 3: get initial description
print01Report(mydata, modelname = "/Users/anuschka/Documents/labjournal/results/data_report")
```


```{r,eval=FALSE}
### Step4: specify model
myeff <- includeEffects(myeff, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeff <- includeEffects(myeff, transTriads)
myeff <- includeEffects(myeff, absDiffX, interaction1 = "ki")
myeff <- includeEffects(myeff, sameX, interaction1 = "dutch")
myeff <- includeEffects(myeff, absDiffX, interaction1 = "pub_first")
myeff <- includeEffects(myeff, sameX, interaction1 = "twitter_dum")
#myeff <- includeEffects(myeff, egoPlusAltX, interaction1 = "pubs") #if you have many pubs, you will probably publish more per year?
```


```{r, eval=FALSE}
### Step5 estimate
myAlgorithm <- sienaAlgorithmCreate(projname = "soc_report")
(ans <- siena07(myAlgorithm, data = mydata, effects = myeff))
# (the outer parentheses lead to printing the obtained result on the screen) if necessary, estimate
# further
(ans <- siena07(myAlgorithm, data = mydata, effects = myeff, prevAns = ans))
```
In the above model output, we can see that the density effect is strongly negative and significant. In the network, staff members do not have the wish to copublish with everyone (HOW CAN I INTERPRET THIS BECAUSE NOW THE EFFECT IS VERY STRONG). We also observe that within this network, there is a significant and positive transitive triads effect, meaning that staff members prefer a transitive tie rather than no transitive tie. We also learn that staff members prefer to publish together with staff members that have already published, hence the significant activity and popularity effect. 
Then for the covariates, we see that there is no significant effect of a similar Kardashian Index. Apparently, this is not something the staff members consider in the selection process of co-publishing. This also applies to ethnicity and age, as we see that these effects are both insignificant. However, we do see that there is a significant effect of having Twitter or not. Staff members at sociology have a preference to work together with someone who is the same in terms of (not) having Twitter.  

```{r, eval=FALSE}
save(ans, file="/Users/anuschka/Documents/labjournal/results//socmodel.RData")
```

# RSiena Data Science 

```{r}
rm(list=ls())
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/data/data_net_array.RData")
load("/Users/anuschka/Documents/labjournal/data/datadef_df.RData")
```



```{r, eval=FALSE}
#dependent
dnet <- sienaDependent(dnet_array)

### Step 1: define data
#gender
gender <- as.numeric(datadef_df$gender=="female")
gender <- coCovar(gender)

#Kardashian Index
ki <- as.numeric(datadef_df$ki)
ki <- coCovar(ki)

#Ethnicity
dutch <- as.numeric(datadef_df$dutch)
dutch <- coCovar(dutch)

#Twitter dummy as control variable
twitter_dum <- (datadef_df$twitter_dum)
twitter_dum <- coCovar(twitter_dum)

#year first pub
data_staff_cit %>% group_by(gs_id) %>%
  mutate(pub_first = min(year)) %>% 
  select(c("gs_id", "pub_first")) %>%
  distinct(gs_id, pub_first, .keep_all = TRUE) -> firstpub_df1

datadef_df <- left_join(datadef_df, firstpub_df1)

#if no publication yet, set pub_first op 2023
datadef_df %>% mutate(pub_first = replace_na(pub_first, 2023)) -> datadef_df

pub_first <-  coCovar(datadef_df$pub_first)
```

```{r, eval=FALSE}
#Save the dataset now with pubyear
save(datadef_df, file="/Users/anuschka/Documents/labjournal/data/datadef_df.RData")
```


```{r, eval=FALSE}
mydata <- sienaDataCreate(dnet, gender, ki, dutch, pub_first, twitter_dum)
```

```{r, eval=FALSE}
### Step 2: create effects structure
myeff <- getEffects(mydata)
effectsDocumentation(myeff)
### Step 3: get initial description
print01Report(mydata, modelname = "/Users/anuschka/Documents/labjournal/results/data_report")
```


```{r, eval=FALSE}
### Step4: specify model
myeff <- includeEffects(myeff, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeff <- includeEffects(myeff, transTriads)
myeff <- includeEffects(myeff, absDiffX, interaction1 = "ki")
myeff <- includeEffects(myeff, sameX, interaction1 = "dutch")
myeff <- includeEffects(myeff, absDiffX, interaction1 = "pub_first")
myeff <- includeEffects(myeff, sameX, interaction1 = "twitter_dum")
#myeff <- includeEffects(myeff, egoPlusAltX, interaction1 = "pubs") #if you have many pubs, you will probably publish more per year?
```


```{r, eval=FALSE}
### Step5 estimate
myAlgorithm <- sienaAlgorithmCreate(projname = "data_report")
(ans <- siena07(myAlgorithm, data = mydata, effects = myeff))
# (the outer parentheses lead to printing the obtained result on the screen) if necessary, estimate
# further
(ans <- siena07(myAlgorithm, data = mydata, effects = myeff, prevAns = ans))
```
```{r, eval=FALSE}
save(ans, file="/Users/anuschka/Documents/labjournal/results/data_model.RData")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/data_model.RData")
summary(ans)
```


In this model of data science we see similar effects as at the sociology department. There again is a negative density effect, albeit less strong. Data scientist have a preference for copublishing with staff members that they know from publishing with another staff members (the transitivity), and this effect is larger for this network than that of sociology. This was also visible in the transitivity effect of the descriptive statistics. The effect of activity and popularity is insignificant: Apparently data scientist do not have a preference to copublish with staff members that have already copublished a lot. Just like at the sociology department, the effects of the KI, ethnicity and age are not significant. These factors do not play a role in the selection effect of finding co-authors. (Not) having twitter is significant, thus the data science staff do select staff members to copublish with that have the same twitter status as themselves. 
