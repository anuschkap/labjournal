---
title: "R Siena"
author: "Anuschka Peelen"
date: "`r Sys.Date()`"
output: html_document
---

```{r warning=FALSE, globalsettings, echo=FALSE, results='hide'}
library(knitr)

knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()



colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/data/data_net_array.RData")
load("/Users/anuschka/Documents/labjournal/data/socdef_net_array.RData")
load("/Users/anuschka/Documents/labjournal/data/socdef_df.RData")
load("/Users/anuschka/Documents/labjournal/data/datadef_df.RData")
load("/Users/anuschka/Documents/labjournal/data/soc_twitterinfo.RData")
```

# Estimate a model for sociology

```{r, echo=FALSE}
#load dataobjects
#load("./data/soc_staff_cit.RData")
library(RSiena)
library(tidyverse)
```

```{r, eval=FALSE}
#dependent
snet <- sienaDependent(soc_net_array)

### Step 1: define data
#gender
gender <- as.numeric(socdef_df$gender=="female")
gender <- coCovar(gender)

#Kardashian Index
ki <- as.numeric(socdef_df$ki)
ki <- coCovar(ki)

#Ethnicity
dutch <- as.numeric(socdef_df$dutch)
dutch <- coCovar(dutch)

#Twitter dummy as control variable
twitter_dum <- (socdef_df$twitter_dum)
twitter_dum <- coCovar(twitter_dum)

#Twitter followercount
#followers <- as.numeric(soc_twitterinfo$twfollowercounts)
#followers <- coCovar(followers)



#year first pub
# soc_staff_cit %>% group_by(gs_id) %>%
#   mutate(pub_first = min(year)) %>% 
#   select(c("gs_id", "pub_first")) %>%
#   distinct(gs_id, pub_first, .keep_all = TRUE) -> firstpub_df
# 
# socdef_df <- left_join(socdef_df, firstpub_df)
# 
# #if no publication yet, set pub_first op 2023
# socdef_df %>% mutate(pub_first = replace_na(pub_first, 2023)) -> socdef_df

pub_first <-  coCovar(socdef_df$pub_first)
```

```{r, eval=FALSE}
mydata <- sienaDataCreate(snet, gender, ki, dutch, pub_first, twitter_dum)
```

```{r,eval=FALSE}
### Step 2: create effects structure
myeffs <- getEffects(mydata)
effectsDocumentation(myeffs)
### Step 3: get initial description
print01Report(mydata, modelname = "/Users/anuschka/Documents/labjournal/results/soc_report")
```

```{r,eval=FALSE}
### Step4: specify model with structural effects
myeffs <- includeEffects(myeffs, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeffs <- includeEffects(myeffs, transTriads)
```

```{r, eval=FALSE}
### Step5 estimate
myAlgorithm <- sienaAlgorithmCreate(projname = "soc_report")
(ans <- siena07(myAlgorithm, data = mydata, effects = myeffs))
# (the outer parentheses lead to printing the obtained result on the screen) if necessary, estimate
# further
(ans <- siena07(myAlgorithm, data = mydata, effects = myeffs, prevAns = ans))
```

```{r, eval=FALSE}
#Save the last model since it has the lowest maximum convergence ratio. 
save(ans, file="/Users/anuschka/Documents/labjournal/results/soc_model_struc")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/soc_model_struc")
summary(ans)
```

In the above model output, we can see that the density effect is strongly negative and significant. In the network, staff members do not have the wish to copublish with everyone (HOW CAN I INTERPRET THIS BECAUSE NOW THE EFFECT IS VERY STRONG). We also observe that within this network, there is a significant and positive transitive triads effect, meaning that staff members prefer a transitive tie rather than no transitive tie. We also learn that staff members prefer to publish together with staff members that have already published, hence the significant activity and popularity effect.

```{r,eval=FALSE}
myeffs1 <- getEffects(mydata)
myeffs1 <- includeEffects(myeffs1, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeffs1 <- includeEffects(myeffs1, transTriads)
myeffs1 <- includeEffects(myeffs1, absDiffX, interaction1 = "ki")
myeffs1 <- includeEffects(myeffs1, sameX, interaction1 = "dutch")
myeffs1 <- includeEffects(myeffs1, absDiffX, interaction1 = "pub_first")
myeffs1 <- includeEffects(myeffs1, sameX, interaction1 = "twitter_dum")
myeffs1 <- includeEffects(myeffs1, sameX, interaction1 = "gender")
```

```{r, eval=FALSE}
(ans1 <- siena07(myAlgorithm, data = mydata, effects = myeffs1, prevAns = ans))
```

```{r, eval=FALSE}
#Save the last model since it has the lowest maximum convergence ratio. 
save(ans1, file="/Users/anuschka/Documents/labjournal/results/soc_model_cov1")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/soc_model_cov1")
summary(ans1)
```

Now apart from the network effects (which effects remain significant), the KI is now included as a covariate. We see that this effect is not signficant.This means that scientists do not prefer to co-publish with other scientist that have a similar Kardashian Index. Apparently, this is not something the staff members consider in the selection process of co-publishing. This also applies to ethnicity, age and gender, as we see that these effects are both insignificant. However, we do see that there is a significant effect of having Twitter or not. Staff members at sociology have a preference to work together with someone who is the same in terms of (not) having Twitter.

```{r,eval=FALSE}
myeffs2 <- getEffects(mydata)
myeffs2 <- includeEffects(myeffs2, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeffs2 <- includeEffects(myeffs2, transTriads)
myeffs2 <- includeEffects(myeffs2, altX, interaction1 = "ki")
myeffs2 <- includeEffects(myeffs2, sameX, interaction1 = "dutch")
myeffs2 <- includeEffects(myeffs2, absDiffX, interaction1 = "pub_first")
myeffs2 <- includeEffects(myeffs2, sameX, interaction1 = "twitter_dum")
myeffs2 <- includeEffects(myeffs2, sameX, interaction1 = "gender")
```

```{r, eval=FALSE}
(ans2 <- siena07(myAlgorithm, data = mydata, effects = myeffs2, prevAns = ans1))
```

```{r, eval=FALSE}
#Save the last model since it has the lowest maximum convergence ratio. 
save(ans2, file="/Users/anuschka/Documents/labjournal/results/soc_model_cov2")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/soc_model_cov2")
summary(ans2)
```

The above model shows us that the effect of the KI of the alter is not significant. This could mean that scientists do not regard the Kardashian Index of the other, so it does not matter whether it's lower or higher than their own.

# RSiena Data Science

```{r}
rm(list=ls())
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/data/data_net_array.RData")
load("/Users/anuschka/Documents/labjournal/data/datadef_df.RData")
```

```{r, eval=FALSE}
#dependent
dnet <- sienaDependent(dnet_array)

### Step 1: define data
#gender
gender <- as.numeric(datadef_df$gender=="female")
gender <- coCovar(gender)

#Kardashian Index
ki <- as.numeric(datadef_df$ki)
ki <- coCovar(ki)

#Ethnicity
dutch <- as.numeric(datadef_df$dutch)
dutch <- coCovar(dutch)

#Twitter dummy as control variable
twitter_dum <- (datadef_df$twitter_dum)
twitter_dum <- coCovar(twitter_dum)

# #year first pub
# data_staff_cit %>% group_by(gs_id) %>%
#   mutate(pub_first = min(year)) %>% 
#   select(c("gs_id", "pub_first")) %>%
#   distinct(gs_id, pub_first, .keep_all = TRUE) -> firstpub_df1
# 
# datadef_df <- left_join(datadef_df, firstpub_df1)
# 
# #if no publication yet, set pub_first op 2023
# datadef_df %>% mutate(pub_first = replace_na(pub_first, 2023)) -> datadef_df

pub_first <-  coCovar(datadef_df$pub_first)
```

```{r, eval=FALSE}
mydata <- sienaDataCreate(dnet, gender, ki, dutch, pub_first, twitter_dum)
```

```{r, eval=FALSE}
### Step 2: create effects structure
myeff <- getEffects(mydata)
effectsDocumentation(myeff)
### Step 3: get initial description
print01Report(mydata, modelname = "/Users/anuschka/Documents/labjournal/results/data_report")
```

```{r, eval=FALSE}
### Step4: specify model
myeff <- includeEffects(myeff, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeff <- includeEffects(myeff, transTriads)
```

```{r, eval=FALSE}
### Step5 estimate
myAlgorithm <- sienaAlgorithmCreate(projname = "data_report")
(ans <- siena07(myAlgorithm, data = mydata, effects = myeff))
# (the outer parentheses lead to printing the obtained result on the screen) if necessary, estimate
# further
#(ans <- siena07(myAlgorithm, data = mydata, effects = myeff, prevAns = ans))
```

```{r, eval=FALSE}
save(ans, file="/Users/anuschka/Documents/labjournal/results/data_model_struc")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/data_model_struc")
summary(ans)
```

In this model of data science we see similar effects as at the sociology department. There again is a negative density effect, albeit less strong. Data scientist have a preference for copublishing with staff members that they know from publishing with other staff members (the transitivity), and this effect is larger for this network than that of sociology. This was also visible in the transitivity effect of the descriptive statistics. The effect of activity and popularity is insignificant: Apparently data scientist do not have a preference to copublish with staff members that have already copublished a lot.

```{r,eval=FALSE}
myeffd1 <- getEffects(mydata)
myeffd1 <- includeEffects(myeffd1, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeffd1 <- includeEffects(myeffd1, transTriads)
myeffd1 <- includeEffects(myeffd1, absDiffX, interaction1 = "ki")
myeffd1 <- includeEffects(myeffd1, sameX, interaction1 = "dutch")
myeffd1 <- includeEffects(myeffd1, absDiffX, interaction1 = "pub_first")
myeffd1 <- includeEffects(myeffd1, sameX, interaction1 = "twitter_dum")
myeffd1 <- includeEffects(myeffd1, sameX, interaction1 = "gender")
```

```{r, eval=FALSE}
(ansd1 <- siena07(myAlgorithm, data = mydata, effects = myeffd1, prevAns = ans))
```

```{r, eval=FALSE}
#Save the last model since it has the lowest maximum convergence ratio. 
save(ansd1, file="/Users/anuschka/Documents/labjournal/results/data_model_cov1")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/data_model_cov1")
summary(ansd1)
```

In the above model, the structural effects are the same as in the first model. Just like at the sociology department, the effects of the KI, ethnicity and age are not significant. These factors do not play a role in the selection effect of finding co-authors. (Not) having twitter is significant, thus the data science staff do select staff members to copublish with that have the same twitter status as themselves. (IN THIS MODEL NOT SIGNIFICANT, CHECK AGAIN WHAT HAPPENS IN BETTER FITTING MODEL)

```{r,eval=FALSE}
myeffd2 <- getEffects(mydata)
myeffd2 <- includeEffects(myeffd2, degPlus) #some publish a lot, some not. (interpretation: talent/luck? )
myeffd2 <- includeEffects(myeffd2, transTriads)
myeffd2 <- includeEffects(myeffd2, altX, interaction1 = "ki")
myeffd2 <- includeEffects(myeffd2, sameX, interaction1 = "dutch")
myeffd2 <- includeEffects(myeffd2, absDiffX, interaction1 = "pub_first")
myeffd2 <- includeEffects(myeffd2, sameX, interaction1 = "twitter_dum")
myeffd2 <- includeEffects(myeffd2, sameX, interaction1 = "gender")
```

```{r, eval=FALSE}
(ansd2 <- siena07(myAlgorithm, data = mydata, effects = myeffd2, prevAns = ansd1))
```

```{r, eval=FALSE}
#Save the last model since it has the lowest maximum convergence ratio. 
save(ansd2, file="/Users/anuschka/Documents/labjournal/results/data_model_cov2")
```

```{r, echo=FALSE}
load("/Users/anuschka/Documents/labjournal/results/data_model_cov2")
summary(ansd2)
```

In the last model, we see that the KI of the alter again does not matter.
